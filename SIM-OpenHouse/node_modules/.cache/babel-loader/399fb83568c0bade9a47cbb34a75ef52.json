{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\BearBear\\\\Coding_Projects\\\\UOW-CSIT321 (FYP)\\\\FYP20S313-Mobile\\\\SIM-OpenHouse\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\BearBear\\\\Coding_Projects\\\\UOW-CSIT321 (FYP)\\\\FYP20S313-Mobile\\\\SIM-OpenHouse\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\BearBear\\\\Coding_Projects\\\\UOW-CSIT321 (FYP)\\\\FYP20S313-Mobile\\\\SIM-OpenHouse\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import{IonContent,IonPage,IonGrid,IonRow,IonSearchbar,IonCol,IonList,IonLabel,IonText,IonHeader,IonLoading,IonButton,IonItemDivider,IonModal,IonTextarea}from'@ionic/react';import React,{useEffect,useState}from'react';import{useHistory,useParams}from'react-router';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{faClock,faComment,faCommentAlt,faCommentDots}from'@fortawesome/free-regular-svg-icons';import firebase from'firebase';import'../../css/Global.css';import'../../css/Forum.css';import TopNav from'../../components/TopNav';import ForumRules from'../../components/Forum/ForumRules';import Forum_FlagModal from'../../components/Forum/Forum_FlagModal';import{db}from'../../firebase';import{useAuth}from'../../modules/auth';import{forumPostsAsc}from'../../modules/compare';var ForumViewQuestion=function ForumViewQuestion(){var _useParams=useParams(),id=_useParams.id,uid=_useParams.uid;var _useAuth=useAuth(),userID=_useAuth.userID;var history=useHistory();var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showAddCommentModal=_useState4[0],setShowAddCommentModal=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),showReplyCommentModal=_useState6[0],setShowReplyCommentModal=_useState6[1];var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),question=_useState8[0],setQuestion=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),entry=_useState10[0],setEntry=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),comments=_useState12[0],setComments=_useState12[1];var _useState13=useState({commenter:\"\",commentId:0,commenterId:0}),_useState14=_slicedToArray(_useState13,2),commentDetails=_useState14[0],setCommentDetails=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),keyword=_useState16[0],setKeyword=_useState16[1];var handleComment=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var time,name,docRef,increment;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setLoading(true);time=new Date();if(!(entry!==\"\")){_context.next=12;break;}_context.next=6;return db.collection('Students').doc(userID).get().then(function(doc){var _doc$data,_doc$data2;if(doc.exists)name=((_doc$data=doc.data())===null||_doc$data===void 0?void 0:_doc$data.firstName)+\" \"+((_doc$data2=doc.data())===null||_doc$data2===void 0?void 0:_doc$data2.lastName);});case 6:docRef=db.collection('Forum').doc(userID).collection('Comments').doc(time.getTime().toString());_context.next=9;return docRef.set({id:+docRef.id,entry:entry,questionId:+id,posterName:name,posterId:userID,dateTime:time.toLocaleString().replace(/\\//g,\"-\"),deleted:false,reported:false,noOfReplies:0});case 9:increment=firebase.firestore.FieldValue.increment(1);_context.next=12;return db.collection('Forum').doc(uid).collection('Questions').doc(id).update({noOfComments:increment});case 12:_context.next=17;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);return _context.abrupt(\"return\",console.log(_context.t0));case 17:_context.prev=17;setLoading(false);setShowAddCommentModal(false);setEntry(\"\");return _context.finish(17);case 22:case\"end\":return _context.stop();}}},_callee,null,[[0,14,17,22]]);}));return function handleComment(){return _ref.apply(this,arguments);};}();var handleReply=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(commentId,commenterId){var time,name,docRef,increment;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;setLoading(true);time=new Date();_context2.next=5;return db.collection('Students').doc(userID).get().then(function(doc){var _doc$data3,_doc$data4;if(doc.exists)name=((_doc$data3=doc.data())===null||_doc$data3===void 0?void 0:_doc$data3.firstName)+\" \"+((_doc$data4=doc.data())===null||_doc$data4===void 0?void 0:_doc$data4.lastName);});case 5:docRef=db.collection('Forum').doc(userID).collection('Comments').doc(time.getTime().toString());_context2.next=8;return docRef.set({id:+docRef.id,entry:entry,posterName:name,posterId:userID,dateTime:time.toLocaleString().replace(/\\//g,\"-\"),deleted:false,reported:false,commentId:+commentId,questionId:+id});case 8:increment=firebase.firestore.FieldValue.increment(1);_context2.next=11;return db.collection('Forum').doc(commenterId).collection('Comments').doc(commentId).update({noOfReplies:increment});case 11:_context2.next=16;break;case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](0);return _context2.abrupt(\"return\",console.log(_context2.t0));case 16:_context2.prev=16;setLoading(false);setShowReplyCommentModal(false);setEntry(\"\");return _context2.finish(16);case 21:case\"end\":return _context2.stop();}}},_callee2,null,[[0,13,16,21]]);}));return function handleReply(_x,_x2){return _ref2.apply(this,arguments);};}();useEffect(function(){db.collection('Forum').doc(uid).collection('Questions').doc(id).get().then(function(entry){if(entry.exists){var _entry$data,_entry$data2,_entry$data3,_entry$data4,_entry$data5,_entry$data6;setQuestion({title:(_entry$data=entry.data())===null||_entry$data===void 0?void 0:_entry$data.entry,asker:(_entry$data2=entry.data())===null||_entry$data2===void 0?void 0:_entry$data2.posterName,askerId:(_entry$data3=entry.data())===null||_entry$data3===void 0?void 0:_entry$data3.posterId,dateTime:(_entry$data4=entry.data())===null||_entry$data4===void 0?void 0:_entry$data4.dateTime,commentCount:(_entry$data5=entry.data())===null||_entry$data5===void 0?void 0:_entry$data5.noOfComments,removed:(_entry$data6=entry.data())===null||_entry$data6===void 0?void 0:_entry$data6.deleted});}});return db.collectionGroup('Comments').where(\"questionId\",\"==\",+id).onSnapshot(function(entries){var comments=[];setComments(comments);entries.forEach(function(comment){comments.unshift({id:+comment.id,entry:comment.data().entry,dateTime:comment.data().dateTime,user:comment.data().posterName,uid:comment.data().posterId,removed:comment.data().deleted,commentId:comment.data().commentId||null});});setTimeout(function(){setComments(comments.sort(forumPostsAsc));setLoading(false);},500);});},[]);return/*#__PURE__*/React.createElement(IonPage,null,/*#__PURE__*/React.createElement(IonHeader,null,/*#__PURE__*/React.createElement(TopNav,{title:\"Forum\",route:\"/u/forum\",backarrow:true,hamburger:true})),/*#__PURE__*/React.createElement(IonContent,{fullscreen:true,id:\"forum-content\"},/*#__PURE__*/React.createElement(IonGrid,{id:\"forum-searchbar-container\"},/*#__PURE__*/React.createElement(IonRow,{className:\"ion-justify-content-start\"},/*#__PURE__*/React.createElement(IonCol,{size:\"10\",className:\"forum-col\"},/*#__PURE__*/React.createElement(\"form\",{onSubmit:function onSubmit(e){e.preventDefault();history.push(\"/u/forumSearch/\".concat(keyword));}},/*#__PURE__*/React.createElement(IonSearchbar,{value:keyword,onIonChange:function onIonChange(e){return setKeyword(e.detail.value);},enterkeyhint:\"search\",id:\"forum-searchbar\",animated:true}))),/*#__PURE__*/React.createElement(IonCol,{size:\"2\",className:\"forum-col ion-align-self-center\"},/*#__PURE__*/React.createElement(ForumRules,null)))),/*#__PURE__*/React.createElement(IonList,{className:\"forum-container\"},/*#__PURE__*/React.createElement(IonGrid,null,/*#__PURE__*/React.createElement(IonRow,null,/*#__PURE__*/React.createElement(IonLabel,null,/*#__PURE__*/React.createElement(IonText,{className:\"forum-question\"},question.removed===false?question.title:\"[deleted]\"))),/*#__PURE__*/React.createElement(IonRow,{className:\"ion-justify-content-end\"},/*#__PURE__*/React.createElement(IonText,{className:\"forum-question-details\",id:\"forum-userName\"},\"~ \",question.asker)),/*#__PURE__*/React.createElement(IonRow,{className:\"ion-align-items-end ion-justify-content-start\",id:\"forum-question-detail-container\"},/*#__PURE__*/React.createElement(IonCol,{size:\"1\",className:\"forum-col ion-align-self-end\"},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faClock,size:\"sm\"})),/*#__PURE__*/React.createElement(IonCol,{size:\"6\",className:\"forum-col ion-align-self-end\"},/*#__PURE__*/React.createElement(IonText,{className:\"forum-question-details\"},question.dateTime)),/*#__PURE__*/React.createElement(IonCol,{size:\"1\",className:\"forum-col ion-align-self-end\"},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faCommentAlt,size:\"sm\"})),/*#__PURE__*/React.createElement(IonCol,{size:\"3\",className:\"forum-col ion-align-self-end\"},/*#__PURE__*/React.createElement(IonText,{className:\"forum-question-details\"},question.commentCount)),/*#__PURE__*/React.createElement(IonCol,{size:\"1\",className:\"ion-align-self-end forum-col\"},/*#__PURE__*/React.createElement(Forum_FlagModal,{disabled:question.removed===false?false:true,postId:question.id,postType:\"Question\",postContent:question.title,offender:question.asker,offenderId:question.askerId}))))),/*#__PURE__*/React.createElement(IonGrid,{id:\"add-comment-container\"},/*#__PURE__*/React.createElement(IonRow,null,/*#__PURE__*/React.createElement(IonCol,{className:\"ion-align-self-center\"},/*#__PURE__*/React.createElement(IonText,{id:\"addComment-commentText\"},\"Comments\")),/*#__PURE__*/React.createElement(IonCol,{className:\"ion-align-self-center\"},/*#__PURE__*/React.createElement(IonButton,{id:\"forum-addCommentBtn\",size:\"small\",onClick:function onClick(){return setShowAddCommentModal(true);}},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faComment,size:\"sm\"}),/*#__PURE__*/React.createElement(IonText,{style:{marginLeft:'5%',fontSize:'90%'}},\"Add Comment\"))))),/*#__PURE__*/React.createElement(IonGrid,{id:\"comment-main-container\"},comments.length>0?comments.map(function(post){if(post.commentId===null){return/*#__PURE__*/React.createElement(IonList,{id:\"comment-list\",key:post.id},/*#__PURE__*/React.createElement(IonGrid,{className:\"forum-container\"},/*#__PURE__*/React.createElement(IonRow,null,/*#__PURE__*/React.createElement(IonLabel,null,/*#__PURE__*/React.createElement(IonText,{id:\"comment-text\"},post.removed===false?post.entry:\"[deleted]\"))),/*#__PURE__*/React.createElement(IonRow,{className:\"ion-justify-content-end\"},/*#__PURE__*/React.createElement(IonText,{id:\"comment-userName\"},\"~ \",post.user)),/*#__PURE__*/React.createElement(IonRow,{className:\"ion-align-items-end ion-justify-content-start\",id:\"comment-detail-container\"},/*#__PURE__*/React.createElement(IonCol,{size:\"1\",className:\"forum-col ion-align-self-end\"},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faClock,size:\"sm\"})),/*#__PURE__*/React.createElement(IonCol,{size:\"6\",className:\"forum-col ion-align-self-end\"},/*#__PURE__*/React.createElement(IonText,{id:\"comment-details\"},post.dateTime)),/*#__PURE__*/React.createElement(IonCol,{size:\"4\",className:\"forum-col ion-align-self-end\"},question.askerId===userID||post.uid===userID?/*#__PURE__*/React.createElement(IonButton,{onClick:function onClick(){return[setShowReplyCommentModal(true),setCommentDetails({commenter:post.user,commentId:post.id,commenterId:post.uid})];},id:\"comment-replyBtn\",size:\"small\",disabled:post.removed===false?false:true},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faCommentDots,size:\"sm\"}),/*#__PURE__*/React.createElement(IonText,{style:{marginLeft:'5%'}},\"Reply\")):null),/*#__PURE__*/React.createElement(IonCol,{size:\"1\",className:\"ion-align-self-end forum-col\"},/*#__PURE__*/React.createElement(Forum_FlagModal,{disabled:post.removed===false?false:true,postId:post.id,postType:\"Comment\",postContent:post.entry,offender:post.user,offenderId:post.uid})))),comments.map(function(reply){if(reply.commentId===post.id){return/*#__PURE__*/React.createElement(IonGrid,{className:\"forum-container\",id:\"comment-reply-container\",key:reply.id},/*#__PURE__*/React.createElement(IonRow,null,/*#__PURE__*/React.createElement(IonLabel,null,/*#__PURE__*/React.createElement(IonText,{id:\"comment-text\"},reply.removed===false?reply.entry:\"[deleted]\"))),/*#__PURE__*/React.createElement(IonRow,{className:\"ion-justify-content-end\"},/*#__PURE__*/React.createElement(IonText,{id:\"comment-userName\"},\"~ \",reply.user)),/*#__PURE__*/React.createElement(IonRow,{className:\"ion-align-items-end ion-justify-content-start\",id:\"comment-detail-container\"},/*#__PURE__*/React.createElement(IonCol,{size:\"1\",className:\"forum-col ion-align-self-end\"},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faClock,size:\"sm\"})),/*#__PURE__*/React.createElement(IonCol,{size:\"10\",className:\"forum-col ion-align-self-end\"},/*#__PURE__*/React.createElement(IonText,{id:\"comment-details\"},reply.dateTime)),/*#__PURE__*/React.createElement(IonCol,{size:\"1\",className:\"ion-align-self-end forum-col\"},/*#__PURE__*/React.createElement(Forum_FlagModal,{disabled:false,postId:reply.id,postType:\"Reply\",postContent:reply.entry,offender:reply.user,offenderId:reply.uid}))));}}));}}):/*#__PURE__*/React.createElement(IonGrid,null,/*#__PURE__*/React.createElement(IonRow,{className:\"ion-justify-content-center\"},/*#__PURE__*/React.createElement(IonText,{color:\"medium\",id:\"no-comment-text\"},\"There are currently no comments for this part.\")))),/*#__PURE__*/React.createElement(IonModal,{isOpen:showAddCommentModal,cssClass:\"post-question-modal\",onDidDismiss:function onDidDismiss(){return setShowAddCommentModal(false);}},/*#__PURE__*/React.createElement(IonContent,null,/*#__PURE__*/React.createElement(IonGrid,{id:\"postQns-modal-container\"},/*#__PURE__*/React.createElement(IonRow,{style:{paddingTop:'1%'}},/*#__PURE__*/React.createElement(IonLabel,{id:\"postQns-title\"},\"Add Comment\")),/*#__PURE__*/React.createElement(IonItemDivider,null),/*#__PURE__*/React.createElement(IonRow,{id:\"postQns-modal-inputArea\"},/*#__PURE__*/React.createElement(IonTextarea,{value:entry,onIonChange:function onIonChange(e){return setEntry(e.detail.value);},rows:11,contentEditable:true,required:true})),/*#__PURE__*/React.createElement(IonRow,{className:\"ion-justify-content-around\"},/*#__PURE__*/React.createElement(IonButton,{id:\"postQns-close-button\",fill:\"outline\",onClick:function onClick(){return setShowAddCommentModal(false);}},\"CANCEL\"),/*#__PURE__*/React.createElement(IonButton,{id:\"postQns-post-button\",onClick:handleComment},\"COMMENT\"))))),/*#__PURE__*/React.createElement(IonModal,{isOpen:showReplyCommentModal,cssClass:\"post-question-modal\",onDidDismiss:function onDidDismiss(){return setShowReplyCommentModal(false);}},/*#__PURE__*/React.createElement(IonContent,null,/*#__PURE__*/React.createElement(IonGrid,{id:\"postQns-modal-container\"},/*#__PURE__*/React.createElement(IonRow,{style:{paddingTop:'1%'}},/*#__PURE__*/React.createElement(IonLabel,{id:\"postQns-title\"},\"Reply to \",commentDetails.commenter,\"'s comment\")),/*#__PURE__*/React.createElement(IonItemDivider,null),/*#__PURE__*/React.createElement(IonRow,{id:\"postQns-modal-inputArea\"},/*#__PURE__*/React.createElement(IonTextarea,{value:entry,onIonChange:function onIonChange(e){return setEntry(e.detail.value);},rows:11,contentEditable:true,required:true})),/*#__PURE__*/React.createElement(IonRow,{className:\"ion-justify-content-around\"},/*#__PURE__*/React.createElement(IonButton,{id:\"postQns-close-button\",fill:\"outline\",onClick:function onClick(){return setShowReplyCommentModal(false);}},\"CANCEL\"),/*#__PURE__*/React.createElement(IonButton,{id:\"postQns-post-button\",onClick:function onClick(){return handleReply(commentDetails.commentId.toString(),commentDetails.commenterId.toString());}},\"COMMENT\"))))),/*#__PURE__*/React.createElement(IonLoading,{isOpen:loading})));};export default ForumViewQuestion;","map":{"version":3,"sources":["D:/BearBear/Coding_Projects/UOW-CSIT321 (FYP)/FYP20S313-Mobile/SIM-OpenHouse/src/pages/Forum/ForumViewQuestion.tsx"],"names":["IonContent","IonPage","IonGrid","IonRow","IonSearchbar","IonCol","IonList","IonLabel","IonText","IonHeader","IonLoading","IonButton","IonItemDivider","IonModal","IonTextarea","React","useEffect","useState","useHistory","useParams","FontAwesomeIcon","faClock","faComment","faCommentAlt","faCommentDots","firebase","TopNav","ForumRules","Forum_FlagModal","db","useAuth","forumPostsAsc","ForumViewQuestion","id","uid","userID","history","loading","setLoading","showAddCommentModal","setShowAddCommentModal","showReplyCommentModal","setShowReplyCommentModal","question","setQuestion","entry","setEntry","comments","setComments","commenter","commentId","commenterId","commentDetails","setCommentDetails","keyword","setKeyword","handleComment","time","Date","collection","doc","get","then","exists","name","data","firstName","lastName","docRef","getTime","toString","set","questionId","posterName","posterId","dateTime","toLocaleString","replace","deleted","reported","noOfReplies","increment","firestore","FieldValue","update","noOfComments","console","log","handleReply","title","asker","askerId","commentCount","removed","collectionGroup","where","onSnapshot","entries","forEach","comment","unshift","user","setTimeout","sort","e","preventDefault","push","detail","value","marginLeft","fontSize","length","map","post","reply","paddingTop"],"mappings":"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","sourcesContent":["import { IonContent, IonPage, IonGrid, IonRow, IonSearchbar, IonCol, IonList, IonLabel, IonText, IonHeader, IonLoading, IonButton, IonItemDivider, IonModal, IonTextarea } from '@ionic/react';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useHistory, useParams } from 'react-router';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faClock, faComment, faCommentAlt, faCommentDots } from '@fortawesome/free-regular-svg-icons';\r\nimport firebase from 'firebase';\r\n\r\nimport '../../css/Global.css';\r\nimport '../../css/Forum.css';\r\nimport TopNav from '../../components/TopNav';\r\nimport ForumRules from '../../components/Forum/ForumRules';\r\nimport Forum_FlagModal from '../../components/Forum/Forum_FlagModal';\r\nimport { db } from '../../firebase';\r\nimport { useAuth } from '../../modules/auth';\r\nimport { forumPostsAsc } from '../../modules/compare';\r\n\r\ninterface RouteParams {\r\n    id: string;\r\n    uid: string;\r\n}\r\n\r\nconst ForumViewQuestion: React.FC = () => {\r\n    const { id, uid } = useParams<RouteParams>();\r\n    const { userID } = useAuth();\r\n\r\n    let history = useHistory();\r\n\r\n    const [loading, setLoading] = useState(true);\r\n    const [showAddCommentModal, setShowAddCommentModal] = useState(false);\r\n    const [showReplyCommentModal, setShowReplyCommentModal] = useState(false);\r\n    const [question, setQuestion] = useState<any>({});\r\n    const [entry, setEntry] = useState(\"\");\r\n    const [comments, setComments] = useState([]);\r\n    const [commentDetails, setCommentDetails] = useState({ commenter: \"\", commentId: 0, commenterId: 0 });\r\n    const [keyword, setKeyword] = useState(\"\");\r\n\r\n\r\n    const handleComment = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const time = new Date();\r\n            let name: string;\r\n\r\n            if (entry !== \"\") {\r\n                await db.collection('Students').doc(userID).get().then(doc => {\r\n                    if (doc.exists)\r\n                        name = doc.data()?.firstName + \" \" + doc.data()?.lastName;\r\n                });\r\n\r\n                const docRef = db.collection('Forum').doc(userID).collection('Comments').doc((time.getTime()).toString());\r\n                await docRef.set({\r\n                    id: +docRef.id,\r\n                    entry: entry,\r\n                    questionId: +id,\r\n                    posterName: name!,\r\n                    posterId: userID,\r\n                    dateTime: time.toLocaleString().replace(/\\//g, \"-\"),\r\n                    deleted: false,\r\n                    reported: false,\r\n                    noOfReplies: 0\r\n                });\r\n\r\n                const increment = firebase.firestore.FieldValue.increment(1);\r\n                await db.collection('Forum').doc(uid).collection('Questions').doc(id).update({\r\n                    noOfComments: increment,\r\n                });\r\n            }\r\n        } catch (e) {\r\n            return console.log(e);\r\n        } finally {\r\n            setLoading(false);\r\n            setShowAddCommentModal(false);\r\n            setEntry(\"\");\r\n        }\r\n    }\r\n\r\n    const handleReply = async (commentId: string, commenterId: string) => {\r\n        try {\r\n            setLoading(true);\r\n            const time = new Date();\r\n            let name: string;\r\n\r\n            await db.collection('Students').doc(userID).get().then(doc => {\r\n                if (doc.exists)\r\n                    name = doc.data()?.firstName + \" \" + doc.data()?.lastName;\r\n            });\r\n            \r\n            const docRef = db.collection('Forum').doc(userID).collection('Comments').doc((time.getTime()).toString());\r\n            await docRef.set({\r\n                id: +docRef.id,\r\n                entry: entry,\r\n                posterName: name!,\r\n                posterId: userID,\r\n                dateTime: time.toLocaleString().replace(/\\//g, \"-\"),\r\n                deleted: false,\r\n                reported: false,\r\n                commentId: +commentId,\r\n                questionId: +id\r\n            });\r\n\r\n            const increment = firebase.firestore.FieldValue.increment(1);\r\n            await db.collection('Forum').doc(commenterId).collection('Comments').doc(commentId).update({\r\n                noOfReplies: increment,\r\n            });\r\n        } catch (e) {\r\n            return console.log(e);\r\n        } finally {\r\n            setLoading(false);\r\n            setShowReplyCommentModal(false);\r\n            setEntry(\"\");\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        db.collection('Forum').doc(uid).collection('Questions').doc(id).get().then(entry => {\r\n            if (entry.exists) {\r\n                setQuestion({\r\n                    title: entry.data()?.entry,\r\n                    asker: entry.data()?.posterName,\r\n                    askerId: entry.data()?.posterId,\r\n                    dateTime: entry.data()?.dateTime,\r\n                    commentCount: entry.data()?.noOfComments,\r\n                    removed: entry.data()?.deleted\r\n                });\r\n            }\r\n        });\r\n\r\n        return db.collectionGroup('Comments').where(\"questionId\", \"==\", +id).onSnapshot(entries => {\r\n            const comments: any = [];\r\n            setComments(comments)\r\n\r\n            entries.forEach(comment => {\r\n                comments.unshift({\r\n                    id: +comment.id,\r\n                    entry: comment.data().entry,\r\n                    dateTime: comment.data().dateTime,\r\n                    user: comment.data().posterName,\r\n                    uid: comment.data().posterId,\r\n                    removed: comment.data().deleted,\r\n                    commentId: comment.data().commentId || null\r\n                });\r\n            });\r\n\r\n            setTimeout(() => {\r\n                setComments(comments.sort(forumPostsAsc));\r\n                setLoading(false);\r\n            }, 500);\r\n        });\r\n    }, []);\r\n\r\n    return (\r\n        <IonPage>\r\n            <IonHeader>\r\n                <TopNav title=\"Forum\" route=\"/u/forum\" backarrow={ true } hamburger={ true }/>\r\n            </IonHeader>\r\n            \r\n            <IonContent  fullscreen id=\"forum-content\">\r\n                <IonGrid id=\"forum-searchbar-container\">\r\n                    <IonRow className=\"ion-justify-content-start\">\r\n                        <IonCol size=\"10\" className=\"forum-col\">\r\n                            <form onSubmit={e => { e.preventDefault(); history.push(`/u/forumSearch/${keyword}`); }}>\r\n                                <IonSearchbar value={keyword} onIonChange={e => setKeyword(e.detail.value!)} enterkeyhint=\"search\" id=\"forum-searchbar\" animated></IonSearchbar>\r\n                            </form>\r\n                        </IonCol>\r\n                        <IonCol size=\"2\" className=\"forum-col ion-align-self-center\">\r\n                            <ForumRules />\r\n                        </IonCol>\r\n                    </IonRow>\r\n                </IonGrid>\r\n                <IonList className=\"forum-container\">\r\n                    <IonGrid>\r\n                        <IonRow>\r\n                            <IonLabel><IonText className=\"forum-question\">{question.removed === false ? question.title : \"[deleted]\"}</IonText></IonLabel>\r\n                        </IonRow>\r\n                        <IonRow className=\"ion-justify-content-end\">\r\n                            <IonText className=\"forum-question-details\" id=\"forum-userName\">~ {question.asker}</IonText>\r\n                        </IonRow>\r\n                        <IonRow className=\"ion-align-items-end ion-justify-content-start\" id=\"forum-question-detail-container\">\r\n                            <IonCol size=\"1\" className=\"forum-col ion-align-self-end\">\r\n                                <FontAwesomeIcon icon={faClock} size=\"sm\"/>\r\n                            </IonCol>\r\n                            <IonCol size=\"6\" className=\"forum-col ion-align-self-end\">\r\n                                <IonText className=\"forum-question-details\">{question.dateTime}</IonText>\r\n                            </IonCol>\r\n                            <IonCol size=\"1\" className=\"forum-col ion-align-self-end\">\r\n                                <FontAwesomeIcon icon={faCommentAlt} size=\"sm\"/>\r\n                            </IonCol>\r\n                            <IonCol size=\"3\" className=\"forum-col ion-align-self-end\">\r\n                                <IonText className=\"forum-question-details\">{question.commentCount}</IonText>\r\n                            </IonCol>\r\n                            <IonCol size=\"1\" className=\"ion-align-self-end forum-col\">\r\n                                <Forum_FlagModal disabled={question.removed === false ? false : true} postId={question.id} postType={\"Question\"} postContent={question.title} offender={question.asker} offenderId={question.askerId} />\r\n                            </IonCol>\r\n                        </IonRow>\r\n                    </IonGrid>\r\n                </IonList>\r\n\r\n                <IonGrid id=\"add-comment-container\">\r\n                    <IonRow>\r\n                        <IonCol className=\"ion-align-self-center\">\r\n                            <IonText id=\"addComment-commentText\">Comments</IonText>\r\n                        </IonCol>\r\n                        <IonCol className=\"ion-align-self-center\">\r\n                            <IonButton id=\"forum-addCommentBtn\" size=\"small\" onClick={() => setShowAddCommentModal(true)}>\r\n                                <FontAwesomeIcon icon={faComment} size=\"sm\" />\r\n                                <IonText style={{marginLeft: '5%', fontSize: '90%'}}>Add Comment</IonText>\r\n                            </IonButton>\r\n                        </IonCol>\r\n                    </IonRow>\r\n                </IonGrid>\r\n\r\n                {/* COMMENT */}\r\n                <IonGrid id=\"comment-main-container\">\r\n                    { comments.length > 0 ? \r\n                        comments.map((post: any) => {\r\n                            if (post.commentId === null) {\r\n                                return (\r\n                                    <IonList id=\"comment-list\" key={post.id}>\r\n                                        <IonGrid className=\"forum-container\">\r\n                                            <IonRow>\r\n                                                <IonLabel><IonText id=\"comment-text\">{post.removed === false ? post.entry : \"[deleted]\"}</IonText></IonLabel>\r\n                                            </IonRow>\r\n                                            <IonRow className=\"ion-justify-content-end\">\r\n                                                <IonText id=\"comment-userName\">~ {post.user}</IonText>\r\n                                            </IonRow>\r\n                                            <IonRow className=\"ion-align-items-end ion-justify-content-start\" id=\"comment-detail-container\">\r\n                                                <IonCol size=\"1\" className=\"forum-col ion-align-self-end\">\r\n                                                    <FontAwesomeIcon icon={faClock} size=\"sm\"/>\r\n                                                </IonCol>\r\n                                                <IonCol size=\"6\" className=\"forum-col ion-align-self-end\">\r\n                                                    <IonText id=\"comment-details\">{post.dateTime}</IonText>\r\n                                                </IonCol>\r\n                                                <IonCol size=\"4\" className=\"forum-col ion-align-self-end\">\r\n                                                    { (question.askerId === userID! || post.uid === userID!) ?\r\n                                                        <IonButton onClick={() => [setShowReplyCommentModal(true), setCommentDetails({ commenter: post.user, commentId: post.id, commenterId: post.uid })]} id=\"comment-replyBtn\" size=\"small\" disabled={post.removed === false ? false : true}>\r\n                                                            <FontAwesomeIcon icon={faCommentDots} size=\"sm\"/>\r\n                                                            <IonText style={{marginLeft: '5%'}}>Reply</IonText>\r\n                                                        </IonButton>\r\n                                                        :\r\n                                                        null\r\n                                                    }\r\n                                                </IonCol>\r\n                                                <IonCol size=\"1\" className=\"ion-align-self-end forum-col\">\r\n                                                    <Forum_FlagModal disabled={post.removed === false ? false : true} postId={post.id} postType={\"Comment\"} postContent={post.entry} offender={post.user} offenderId={post.uid} />\r\n                                                </IonCol>\r\n                                            </IonRow>\r\n                                        </IonGrid>\r\n\r\n                                        {/* REPLY */}\r\n                                        { comments.map((reply: any) => {\r\n                                            if (reply.commentId === post.id) {\r\n                                                return (\r\n                                                    <IonGrid className=\"forum-container\" id=\"comment-reply-container\" key={reply.id}>\r\n                                                        <IonRow>\r\n                                                            <IonLabel>\r\n                                                                <IonText id=\"comment-text\">{reply.removed === false ? reply.entry : \"[deleted]\"}</IonText>\r\n                                                            </IonLabel>\r\n                                                        </IonRow>\r\n                                                        <IonRow className=\"ion-justify-content-end\">\r\n                                                            <IonText id=\"comment-userName\">~ {reply.user}</IonText>\r\n                                                        </IonRow>\r\n                                                        <IonRow className=\"ion-align-items-end ion-justify-content-start\" id=\"comment-detail-container\">\r\n                                                            <IonCol size=\"1\" className=\"forum-col ion-align-self-end\">\r\n                                                                <FontAwesomeIcon icon={faClock} size=\"sm\"/>\r\n                                                            </IonCol>\r\n                                                            <IonCol size=\"10\" className=\"forum-col ion-align-self-end\">\r\n                                                                <IonText id=\"comment-details\">{reply.dateTime}</IonText>\r\n                                                            </IonCol>\r\n                                                            <IonCol size=\"1\" className=\"ion-align-self-end forum-col\">\r\n                                                                <Forum_FlagModal disabled={false} postId={reply.id} postType={\"Reply\"} postContent={reply.entry} offender={reply.user} offenderId={reply.uid} />\r\n                                                            </IonCol>\r\n                                                        </IonRow>\r\n                                                    </IonGrid>\r\n                                                )\r\n                                            }   \r\n                                        })}\r\n                                    </IonList>\r\n                                )\r\n                            }\r\n                        }\r\n                    ) : (\r\n                        <IonGrid>\r\n                            <IonRow className=\"ion-justify-content-center\">\r\n                                <IonText color=\"medium\" id=\"no-comment-text\">There are currently no comments for this part.</IonText>\r\n                            </IonRow>\r\n                        </IonGrid>\r\n                    )}\r\n                </IonGrid>\r\n                <IonModal isOpen={showAddCommentModal} cssClass='post-question-modal' onDidDismiss={() => setShowAddCommentModal(false)}>\r\n                    <IonContent>\r\n                        <IonGrid id=\"postQns-modal-container\">\r\n                            <IonRow style={{paddingTop: '1%'}}>\r\n                                <IonLabel id=\"postQns-title\">Add Comment</IonLabel>\r\n                            </IonRow>\r\n                            <IonItemDivider />\r\n                            <IonRow id=\"postQns-modal-inputArea\">\r\n                                <IonTextarea value={entry} onIonChange={e => setEntry(e.detail.value!)} rows={11} contentEditable={true} required></IonTextarea>\r\n                            </IonRow>\r\n                            <IonRow className=\"ion-justify-content-around\">\r\n                                <IonButton id=\"postQns-close-button\" fill=\"outline\" onClick={() => setShowAddCommentModal(false)}>CANCEL</IonButton>\r\n                                <IonButton id=\"postQns-post-button\" onClick={handleComment}>COMMENT</IonButton>\r\n                            </IonRow>\r\n                        </IonGrid>\r\n                    </IonContent>\r\n                </IonModal>\r\n                <IonModal isOpen={showReplyCommentModal} cssClass='post-question-modal' onDidDismiss={() => setShowReplyCommentModal(false)}>\r\n                    <IonContent>\r\n                        <IonGrid id=\"postQns-modal-container\">\r\n                            <IonRow style={{paddingTop: '1%'}}>\r\n                                <IonLabel id=\"postQns-title\">Reply to {commentDetails.commenter}'s comment</IonLabel>\r\n                            </IonRow>\r\n                            <IonItemDivider />\r\n                            <IonRow id=\"postQns-modal-inputArea\">\r\n                                <IonTextarea value={entry} onIonChange={e => setEntry(e.detail.value!)} rows={11} contentEditable={true} required></IonTextarea>\r\n                            </IonRow>\r\n                            <IonRow className=\"ion-justify-content-around\">\r\n                                <IonButton id=\"postQns-close-button\" fill=\"outline\" onClick={() => setShowReplyCommentModal(false)}>CANCEL</IonButton>\r\n                                <IonButton id=\"postQns-post-button\" onClick={() => handleReply(commentDetails.commentId.toString(), commentDetails.commenterId.toString())}>COMMENT</IonButton>\r\n                            </IonRow>\r\n                        </IonGrid>\r\n                    </IonContent>\r\n                </IonModal>\r\n                <IonLoading isOpen={loading} />\r\n            </IonContent>\r\n        </IonPage>\r\n    );\r\n};\r\n\r\nexport default ForumViewQuestion;"]},"metadata":{},"sourceType":"module"}