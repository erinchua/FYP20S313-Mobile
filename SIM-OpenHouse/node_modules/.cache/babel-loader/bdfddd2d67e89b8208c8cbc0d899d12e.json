{"ast":null,"code":"var _jsxFileName = \"D:\\\\BearBear\\\\Coding_Projects\\\\UOW-CSIT321 (FYP)\\\\FYP20S313-Mobile\\\\SIM-OpenHouse\\\\src\\\\components\\\\OpenHouseProgrammes\\\\PrizesContent.tsx\";\nimport { IonGrid, IonRow, IonCol, IonText, IonItemDivider, IonButton, IonAlert } from '@ionic/react';\nimport firebase from 'firebase';\nimport React, { useEffect, useState } from 'react';\nimport '../../css/Global.css';\nimport '../../css/OpenHouseActivities.css';\nimport { db } from '../../firebase';\nimport { useAuth } from '../../modules/auth';\nimport { toDateObject } from '../../modules/convert';\n\nconst PrizesContent = props => {\n  const {\n    userID\n  } = useAuth();\n  const [alert, setAlert] = useState({\n    redeemSuccess: false,\n    redeemFail: false,\n    loading: false\n  });\n  const [errorMessage, setErrorMessage] = useState(\"\");\n  const [gameProfile, setGameProfile] = useState({\n    points: 0,\n    redeemed: []\n  });\n  const [venue, setVenue] = useState(\"\");\n\n  const handleRedeem = async prize => {\n    try {\n      setAlert({\n        redeemSuccess: false,\n        redeemFail: false,\n        loading: true\n      });\n\n      if (gameProfile.points >= prize.prizePointsCost && !gameProfile.redeemed.includes(prize.id)) {\n        const batch = db.batch();\n        const pointsDeduct = firebase.firestore.FieldValue.increment(-prize.prizePointsCost);\n        const gamesRef = db.collection('Games').doc(userID);\n        batch.update(gamesRef, {\n          redeemed: firebase.firestore.FieldValue.arrayUnion(prize.id),\n          points: pointsDeduct\n        });\n        const stockDecrement = firebase.firestore.FieldValue.increment(-1);\n        const prizeRef = db.collection('Prizes').doc(prize.id);\n        batch.update(prizeRef, {\n          stock: stockDecrement\n        });\n        await batch.commit();\n      } else {\n        if (gameProfile.points < prize.prizePointsCost) setErrorMessage(\"You don't have enough points to redeem that.\");else if (gameProfile.redeemed.includes(prize.id)) setErrorMessage(\"You have already redeemed that prize.\");\n        throw \"Error occured\";\n      }\n\n      setAlert({\n        redeemSuccess: true,\n        redeemFail: false,\n        loading: false\n      });\n    } catch (e) {\n      setAlert({\n        redeemSuccess: false,\n        redeemFail: true,\n        loading: false\n      });\n      return console.log(e);\n    }\n  };\n\n  useEffect(() => {\n    const today = new Date().getTime();\n    props.venue.forEach(day => {\n      if (today > toDateObject(day.date, \"00:00AM\").getTime()) setVenue(day.venue);\n    });\n    return db.collection('Games').doc(userID).onSnapshot(doc => {\n      var _doc$data, _doc$data2;\n\n      setGameProfile({\n        points: (_doc$data = doc.data()) === null || _doc$data === void 0 ? void 0 : _doc$data.points,\n        redeemed: (_doc$data2 = doc.data()) === null || _doc$data2 === void 0 ? void 0 : _doc$data2.redeemed\n      });\n    });\n  }, []);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(IonAlert, {\n    isOpen: alert.redeemSuccess,\n    onDidDismiss: () => setAlert({\n      redeemSuccess: false,\n      redeemFail: false,\n      loading: false\n    }),\n    cssClass: \"alertBox\",\n    mode: \"md\",\n    header: 'Successfully Redeemed',\n    message: 'Congratulations! You have successfully redeemed this prize!',\n    buttons: ['Close'],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(IonAlert, {\n    isOpen: alert.redeemFail,\n    onDidDismiss: () => setAlert({\n      redeemSuccess: false,\n      redeemFail: false,\n      loading: false\n    }),\n    cssClass: \"alertBox\",\n    mode: \"md\",\n    header: 'Oops! Something went wrong.',\n    message: errorMessage,\n    buttons: ['Close'],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(IonText, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      marginTop: \"2%\",\n      marginBottom: \"-7%\",\n      marginLeft: \"3%\",\n      fontWeight: \"bold\",\n      fontSize: \"95%\",\n      color: \"#424242\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 22\n    }\n  }, \"Prizes\")), /*#__PURE__*/React.createElement(IonItemDivider, {\n    color: \"#EFEFEF\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(IonText, {\n    color: \"medium\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      margin: \"2%\",\n      fontSize: \"80%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 37\n    }\n  }, venue !== \"\" ? `* Redemption booth is located at ${venue}` : null)), /*#__PURE__*/React.createElement(IonGrid, {\n    id: \"prizesContent-tableGrid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(IonRow, {\n    id: \"prizesContent-tableHeader\",\n    className: \"ion-justify-content-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(IonCol, {\n    sizeSm: \"2\",\n    size: \"2\",\n    className: \"prizesContent-Header ion-text-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 21\n    }\n  }, \"Prizes No.\"), /*#__PURE__*/React.createElement(IonCol, {\n    sizeSm: \"3\",\n    size: \"3\",\n    className: \"prizesContent-Header ion-text-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 21\n    }\n  }, \"Prize\"), /*#__PURE__*/React.createElement(IonCol, {\n    sizeSm: \"2\",\n    size: \"2\",\n    className: \"prizesContent-Header ion-text-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 21\n    }\n  }, \"Stock\"), /*#__PURE__*/React.createElement(IonCol, {\n    sizeSm: \"2\",\n    size: \"2\",\n    className: \"prizesContent-Header ion-text-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 21\n    }\n  }, \"Points to Redeem\"), /*#__PURE__*/React.createElement(IonCol, {\n    sizeSm: \"3\",\n    size: \"3\",\n    className: \"prizesContent-Header ion-text-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 21\n    }\n  }, \"Redeem\")), props.prizes.map((prize, index) => {\n    return /*#__PURE__*/React.createElement(IonRow, {\n      className: \"ion-justify-content-center\",\n      key: prize.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(IonCol, {\n      sizeSm: \"2\",\n      size: \"2\",\n      className: \"prizesContent-Data ion-text-wrap\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 29\n      }\n    }, index + 1), /*#__PURE__*/React.createElement(IonCol, {\n      sizeSm: \"3\",\n      size: \"3\",\n      className: \"prizesContent-Data ion-text-wrap\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 29\n      }\n    }, prize.prizeName), /*#__PURE__*/React.createElement(IonCol, {\n      sizeSm: \"2\",\n      size: \"2\",\n      className: \"prizesContent-Data ion-text-wrap\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 29\n      }\n    }, prize.stock), /*#__PURE__*/React.createElement(IonCol, {\n      sizeSm: \"2\",\n      size: \"2\",\n      className: \"prizesContent-Data ion-text-wrap\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 29\n      }\n    }, prize.prizePointsCost), /*#__PURE__*/React.createElement(IonCol, {\n      sizeSm: \"4\",\n      className: \"prizesContent-Data ion-text-wrap\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(IonButton, {\n      size: \"small\",\n      id: \"redeemButton\",\n      onClick: () => handleRedeem(prize),\n      disabled: prize.stock <= 0 ? true : false,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 33\n      }\n    }, \"Redeem\")));\n  })));\n};\n\nexport default PrizesContent;","map":{"version":3,"sources":["D:/BearBear/Coding_Projects/UOW-CSIT321 (FYP)/FYP20S313-Mobile/SIM-OpenHouse/src/components/OpenHouseProgrammes/PrizesContent.tsx"],"names":["IonGrid","IonRow","IonCol","IonText","IonItemDivider","IonButton","IonAlert","firebase","React","useEffect","useState","db","useAuth","toDateObject","PrizesContent","props","userID","alert","setAlert","redeemSuccess","redeemFail","loading","errorMessage","setErrorMessage","gameProfile","setGameProfile","points","redeemed","venue","setVenue","handleRedeem","prize","prizePointsCost","includes","id","batch","pointsDeduct","firestore","FieldValue","increment","gamesRef","collection","doc","update","arrayUnion","stockDecrement","prizeRef","stock","commit","e","console","log","today","Date","getTime","forEach","day","date","onSnapshot","data","marginTop","marginBottom","marginLeft","fontWeight","fontSize","color","margin","prizes","map","index","prizeName"],"mappings":"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","sourcesContent":["import { IonGrid, IonRow, IonCol, IonText, IonItemDivider, IonButton, IonAlert } from '@ionic/react';\r\nimport firebase from 'firebase';\r\nimport React, { useEffect, useState } from 'react';\r\n\r\nimport '../../css/Global.css';\r\nimport '../../css/OpenHouseActivities.css'\r\nimport { db } from '../../firebase';\r\nimport { useAuth } from '../../modules/auth';\r\nimport { toDateObject } from '../../modules/convert';\r\n\r\nconst PrizesContent: React.FC<{ prizes: any, venue: any }> = props => {\r\n    const { userID } = useAuth();\r\n\r\n    const [alert, setAlert] = useState({ redeemSuccess: false, redeemFail: false, loading: false });\r\n    const [errorMessage, setErrorMessage] = useState(\"\");\r\n    const [gameProfile, setGameProfile] = useState<any>({ points: 0, redeemed: [] });\r\n    const [venue, setVenue] = useState(\"\");\r\n\r\n    const handleRedeem = async (prize: any) => {\r\n        try {\r\n            setAlert({ redeemSuccess: false, redeemFail: false, loading: true });\r\n\r\n            if (gameProfile.points >= prize.prizePointsCost && !gameProfile.redeemed.includes(prize.id)) {\r\n                const batch = db.batch();\r\n\r\n                const pointsDeduct = firebase.firestore.FieldValue.increment(-prize.prizePointsCost);\r\n                const gamesRef = db.collection('Games').doc(userID);\r\n                batch.update(gamesRef, {\r\n                    redeemed: firebase.firestore.FieldValue.arrayUnion(prize.id),\r\n                    points: pointsDeduct\r\n                });\r\n\r\n                const stockDecrement = firebase.firestore.FieldValue.increment(-1);\r\n                const prizeRef = db.collection('Prizes').doc(prize.id);\r\n                batch.update(prizeRef, {\r\n                    stock: stockDecrement\r\n                });\r\n\r\n                await batch.commit();\r\n            } else {\r\n                if (gameProfile.points < prize.prizePointsCost)\r\n                    setErrorMessage(\"You don't have enough points to redeem that.\");\r\n                else if (gameProfile.redeemed.includes(prize.id))\r\n                    setErrorMessage(\"You have already redeemed that prize.\");\r\n\r\n                throw \"Error occured\";\r\n            }\r\n\r\n            setAlert({ redeemSuccess: true, redeemFail: false, loading: false });\r\n        } catch(e) {\r\n            setAlert({ redeemSuccess: false, redeemFail: true, loading: false });\r\n            return console.log(e);\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        const today = new Date().getTime();\r\n\r\n        props.venue.forEach((day: any) => {\r\n            if (today > toDateObject(day.date, \"00:00AM\").getTime())\r\n                setVenue(day.venue)\r\n        });\r\n\r\n        return db.collection('Games').doc(userID).onSnapshot(doc => {\r\n            setGameProfile({\r\n                points: doc.data()?.points,\r\n                redeemed: doc.data()?.redeemed\r\n            });\r\n        });\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            <IonAlert\r\n                isOpen={alert.redeemSuccess}\r\n                onDidDismiss={() => setAlert({ redeemSuccess: false, redeemFail: false, loading: false })}\r\n                cssClass='alertBox'\r\n                mode='md'\r\n                header={'Successfully Redeemed'}\r\n                message={'Congratulations! You have successfully redeemed this prize!'}\r\n                buttons={['Close']}\r\n            ></IonAlert>\r\n\r\n            <IonAlert\r\n                isOpen={alert.redeemFail}\r\n                onDidDismiss={() => setAlert({ redeemSuccess: false, redeemFail: false, loading: false })}\r\n                cssClass='alertBox'\r\n                mode='md'\r\n                header={'Oops! Something went wrong.'}\r\n                message={errorMessage}\r\n                buttons={['Close']}\r\n            ></IonAlert>\r\n\r\n            <IonText><div style={{ marginTop: \"2%\", marginBottom: \"-7%\", marginLeft: \"3%\", fontWeight: \"bold\", fontSize: \"95%\", color: \"#424242\" }}>Prizes</div></IonText>\r\n            <IonItemDivider color=\"#EFEFEF\"></IonItemDivider>\r\n            <IonText color=\"medium\"><div style={{ margin: \"2%\", fontSize: \"80%\" }}>{venue !== \"\" ? `* Redemption booth is located at ${venue}` : null}</div></IonText>\r\n            <IonGrid id=\"prizesContent-tableGrid\">\r\n                <IonRow id=\"prizesContent-tableHeader\" className=\"ion-justify-content-center\">\r\n                    <IonCol sizeSm=\"2\" size=\"2\" className=\"prizesContent-Header ion-text-wrap\">Prizes No.</IonCol>\r\n                    <IonCol sizeSm=\"3\" size=\"3\" className=\"prizesContent-Header ion-text-wrap\">Prize</IonCol>\r\n                    <IonCol sizeSm=\"2\" size=\"2\" className=\"prizesContent-Header ion-text-wrap\">Stock</IonCol>\r\n                    <IonCol sizeSm=\"2\" size=\"2\" className=\"prizesContent-Header ion-text-wrap\">Points to Redeem</IonCol>\r\n                    <IonCol sizeSm=\"3\" size=\"3\" className=\"prizesContent-Header ion-text-wrap\">Redeem</IonCol>\r\n                </IonRow>\r\n                {props.prizes.map((prize: any, index: any) => {\r\n                    return (\r\n                        <IonRow className=\"ion-justify-content-center\" key={prize.id}>\r\n                            <IonCol sizeSm=\"2\" size=\"2\" className=\"prizesContent-Data ion-text-wrap\">{index + 1}</IonCol>\r\n                            <IonCol sizeSm=\"3\" size=\"3\" className=\"prizesContent-Data ion-text-wrap\">{prize.prizeName}</IonCol>\r\n                            <IonCol sizeSm=\"2\" size=\"2\" className=\"prizesContent-Data ion-text-wrap\">{prize.stock}</IonCol>\r\n                            <IonCol sizeSm=\"2\" size=\"2\" className=\"prizesContent-Data ion-text-wrap\">{prize.prizePointsCost}</IonCol>\r\n                            <IonCol sizeSm=\"4\" className=\"prizesContent-Data ion-text-wrap\">\r\n                                <IonButton size=\"small\" id=\"redeemButton\" onClick={() => handleRedeem(prize)} disabled={prize.stock <= 0 ? true : false}>Redeem</IonButton>\r\n                            </IonCol>\r\n                        </IonRow>\r\n                    )\r\n                })}\r\n            </IonGrid>\r\n        </>\r\n    );\r\n\r\n};\r\n\r\nexport default PrizesContent;"]},"metadata":{},"sourceType":"module"}