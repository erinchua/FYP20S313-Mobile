{"ast":null,"code":"import _objectSpread from\"D:\\\\BearBear\\\\Coding_Projects\\\\UOW-CSIT321 (FYP)\\\\FYP20S313-Mobile\\\\SIM-OpenHouse\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:\\\\BearBear\\\\Coding_Projects\\\\UOW-CSIT321 (FYP)\\\\FYP20S313-Mobile\\\\SIM-OpenHouse\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\BearBear\\\\Coding_Projects\\\\UOW-CSIT321 (FYP)\\\\FYP20S313-Mobile\\\\SIM-OpenHouse\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\BearBear\\\\Coding_Projects\\\\UOW-CSIT321 (FYP)\\\\FYP20S313-Mobile\\\\SIM-OpenHouse\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import{IonButton,IonCol,IonContent,IonFooter,IonGrid,IonHeader,IonIcon,IonItemDivider,IonLabel,IonLoading,IonModal,IonPage,IonRow,IonSearchbar,IonSegment,IonSegmentButton,IonTextarea,IonToolbar}from'@ionic/react';import React,{useEffect,useState}from'react';import{useHistory}from'react-router';import{addCircleSharp,personSharp}from'ionicons/icons';import\"../../css/Global.css\";import\"../../css/Forum.css\";import TopNav from'../../components/TopNav';import ForumRules from'../../components/Forum/ForumRules';import ForumQuestions from'../../components/Forum/ForumQuestions';import ForumComments from'../../components/Forum/ForumComments';import{db}from'../../firebase';import{useAuth}from'../../modules/auth';var ForumUser=function ForumUser(){var _useAuth=useAuth(),userID=_useAuth.userID;var history=useHistory();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState('forum-myQuestions'),_useState4=_slicedToArray(_useState3,2),qnsCom=_useState4[0],setQnsCom=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),modalSegmentValue=_useState6[0],setModalSegmentValue=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),showPostModal=_useState8[0],setShowPostModal=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),questions=_useState10[0],setQuestions=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),comments=_useState12[0],setComments=_useState12[1];var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),entry=_useState14[0],setEntry=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),keyword=_useState16[0],setKeyword=_useState16[1];var handleQuestions=function handleQuestions(){setQnsCom('forum-myQuestions');};var handleComments=function handleComments(){setQnsCom('forum-myComments');};var handleQuestion=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var time,name,docRef;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setLoading(true);time=new Date();_context.next=5;return db.collection('Students').doc(userID).get().then(function(doc){var _doc$data,_doc$data2;if(doc.exists)name=((_doc$data=doc.data())===null||_doc$data===void 0?void 0:_doc$data.firstName)+\" \"+((_doc$data2=doc.data())===null||_doc$data2===void 0?void 0:_doc$data2.lastName);});case 5:docRef=db.collection('Forum').doc(userID).collection('Questions').doc(time.getTime().toString());_context.next=8;return docRef.set({id:+docRef.id,entry:entry,posterName:name,posterId:userID,dateTime:time.toLocaleString().replace(/\\//g,\"-\"),noOfComments:0,deleted:false,reported:false});case 8:_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);return _context.abrupt(\"return\",console.log(_context.t0));case 13:_context.prev=13;setLoading(false);setShowPostModal(false);setEntry(\"\");return _context.finish(13);case 18:case\"end\":return _context.stop();}}},_callee,null,[[0,10,13,18]]);}));return function handleQuestion(){return _ref.apply(this,arguments);};}();useEffect(function(){var questions=[];var comments=[];var questionsListener=db.collection('Forum').doc(userID).collection('Questions').where(\"deleted\",\"==\",false).onSnapshot(function(snaps){snaps.forEach(function(snap){return questions.push(snap.data());});});var commentsListener=db.collection('Forum').doc(userID).collection('Comments').where(\"deleted\",\"==\",false).onSnapshot(function(snaps){setComments(comments);snaps.forEach(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(snap){var post;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:post=_objectSpread({},snap.data());_context2.next=3;return db.collection('Forum').get().then(function(users){users.forEach(function(user){return db.collection('Forum').doc(user.id).collection('Questions').doc(snap.data().questionId.toString()).onSnapshot(function(question){if(question.exists){var _question$data,_question$data2;post.question=(_question$data=question.data())===null||_question$data===void 0?void 0:_question$data.entry;post.questionRemoved=(_question$data2=question.data())===null||_question$data2===void 0?void 0:_question$data2.deleted;}});});});case 3:comments.push(post);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}());});setTimeout(function(){setQuestions(questions);setComments(comments);questionsListener();commentsListener();setLoading(false);},500);},[]);return/*#__PURE__*/React.createElement(IonPage,null,/*#__PURE__*/React.createElement(IonHeader,null,/*#__PURE__*/React.createElement(TopNav,{title:\"Forum\",route:\"/u/forum\",backarrow:true,hamburger:true})),/*#__PURE__*/React.createElement(IonContent,{fullscreen:true,id:\"forum-content\"},/*#__PURE__*/React.createElement(IonGrid,{id:\"forum-searchbar-container\"},/*#__PURE__*/React.createElement(IonRow,{className:\"ion-justify-content-start\"},/*#__PURE__*/React.createElement(IonCol,{size:\"10\",className:\"forum-col\"},/*#__PURE__*/React.createElement(\"form\",{onSubmit:function onSubmit(e){e.preventDefault();history.push(\"/u/forumSearch/\".concat(keyword));}},/*#__PURE__*/React.createElement(IonSearchbar,{value:keyword,onIonChange:function onIonChange(e){return setKeyword(e.detail.value);},enterkeyhint:\"search\",id:\"forum-searchbar\",animated:true}))),/*#__PURE__*/React.createElement(IonCol,{size:\"2\",className:\"forum-col ion-align-self-center\"},/*#__PURE__*/React.createElement(ForumRules,null)))),/*#__PURE__*/React.createElement(IonGrid,{id:\"forumUser-ionRowCol\"},/*#__PURE__*/React.createElement(IonRow,{id:\"forumUser-ionRowCol\"},/*#__PURE__*/React.createElement(IonCol,{id:\"forumUser-ionRowCol\"},/*#__PURE__*/React.createElement(IonToolbar,null,/*#__PURE__*/React.createElement(IonSegment,{scrollable:true,value:qnsCom,onIonChange:function onIonChange(e){return console.log(\"\".concat(e.detail.value));}},/*#__PURE__*/React.createElement(IonSegmentButton,{value:\"forum-myQuestions\",onClick:function onClick(){return handleQuestions();},className:\"forumUser-heading\"},\"My Questions\"),/*#__PURE__*/React.createElement(IonSegmentButton,{value:\"forum-myComments\",onClick:function onClick(){return handleComments();},className:\"forumUser-heading\"},\"My Comments\")))))),qnsCom==='forum-myQuestions'?/*#__PURE__*/React.createElement(ForumQuestions,{questions:questions}):/*#__PURE__*/React.createElement(ForumComments,{comments:comments}),/*#__PURE__*/React.createElement(IonModal,{isOpen:showPostModal,cssClass:\"post-question-modal\",onDidDismiss:function onDidDismiss(){return setShowPostModal(false);}},/*#__PURE__*/React.createElement(IonContent,null,/*#__PURE__*/React.createElement(IonGrid,{id:\"postQns-modal-container\"},/*#__PURE__*/React.createElement(IonRow,{style:{paddingTop:'1%'}},/*#__PURE__*/React.createElement(IonLabel,{id:\"postQns-title\"},\"Post Question\")),/*#__PURE__*/React.createElement(IonItemDivider,null),/*#__PURE__*/React.createElement(IonRow,{id:\"postQns-modal-inputArea\"},/*#__PURE__*/React.createElement(IonTextarea,{value:entry,onIonChange:function onIonChange(e){return setEntry(e.detail.value);},rows:11,placeholder:\"Type your question here...\",required:true})),/*#__PURE__*/React.createElement(IonRow,{className:\"ion-justify-content-around\"},/*#__PURE__*/React.createElement(IonButton,{id:\"postQns-close-button\",fill:\"outline\",onClick:function onClick(){return[setShowPostModal(false),setModalSegmentValue('')];}},\"CLOSE\"),/*#__PURE__*/React.createElement(IonButton,{id:\"postQns-post-button\",onClick:handleQuestion},\"POST\"))))),/*#__PURE__*/React.createElement(IonLoading,{isOpen:loading})),/*#__PURE__*/React.createElement(IonFooter,null,/*#__PURE__*/React.createElement(IonToolbar,null,/*#__PURE__*/React.createElement(IonSegment,{scrollable:true,value:modalSegmentValue,onIonChange:function onIonChange(e){return console.log(\"\".concat(e.detail.value));}},/*#__PURE__*/React.createElement(IonSegmentButton,{className:\"forum-segmentBtn\",value:\"postQuestionBtn\",onClick:function onClick(){return[setShowPostModal(true),setModalSegmentValue('postQuestionBtn')];}},/*#__PURE__*/React.createElement(IonIcon,{icon:addCircleSharp})),/*#__PURE__*/React.createElement(IonSegmentButton,{className:\"forum-segmentBtn\",value:\"forumUserBtn\",onClick:function onClick(e){e.preventDefault();history.push('/u/forumUser');}},/*#__PURE__*/React.createElement(IonIcon,{icon:personSharp}))))));};export default ForumUser;","map":{"version":3,"sources":["D:/BearBear/Coding_Projects/UOW-CSIT321 (FYP)/FYP20S313-Mobile/SIM-OpenHouse/src/pages/Forum/ForumUser.tsx"],"names":["IonButton","IonCol","IonContent","IonFooter","IonGrid","IonHeader","IonIcon","IonItemDivider","IonLabel","IonLoading","IonModal","IonPage","IonRow","IonSearchbar","IonSegment","IonSegmentButton","IonTextarea","IonToolbar","React","useEffect","useState","useHistory","addCircleSharp","personSharp","TopNav","ForumRules","ForumQuestions","ForumComments","db","useAuth","ForumUser","userID","history","loading","setLoading","qnsCom","setQnsCom","modalSegmentValue","setModalSegmentValue","showPostModal","setShowPostModal","questions","setQuestions","comments","setComments","entry","setEntry","keyword","setKeyword","handleQuestions","handleComments","handleQuestion","time","Date","collection","doc","get","then","exists","name","data","firstName","lastName","docRef","getTime","toString","set","id","posterName","posterId","dateTime","toLocaleString","replace","noOfComments","deleted","reported","console","log","questionsListener","where","onSnapshot","snaps","forEach","snap","push","commentsListener","post","users","user","questionId","question","questionRemoved","setTimeout","e","preventDefault","detail","value","paddingTop"],"mappings":"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","sourcesContent":["import { IonButton, IonCol, IonContent, IonFooter, IonGrid, IonHeader, IonIcon, IonItemDivider, IonLabel, IonLoading, IonModal, IonPage, IonRow, IonSearchbar, IonSegment, IonSegmentButton, IonTextarea, IonToolbar } from '@ionic/react';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useHistory } from 'react-router';\r\nimport { addCircleSharp, personSharp } from 'ionicons/icons';\r\n\r\nimport \"../../css/Global.css\";\r\nimport \"../../css/Forum.css\";\r\nimport TopNav from '../../components/TopNav';\r\nimport ForumRules from '../../components/Forum/ForumRules';\r\nimport ForumQuestions from '../../components/Forum/ForumQuestions';\r\nimport ForumComments from '../../components/Forum/ForumComments';\r\nimport { db } from '../../firebase';\r\nimport { useAuth } from '../../modules/auth';\r\n\r\nconst ForumUser: React.FC = () => {\r\n    const { userID } = useAuth();\r\n\r\n    let history = useHistory();\r\n\r\n    const [loading, setLoading] = useState(false);\r\n    const [qnsCom, setQnsCom] = useState('forum-myQuestions');\r\n    const [modalSegmentValue, setModalSegmentValue] = useState('');\r\n    const [showPostModal, setShowPostModal] = useState(false);\r\n    const [questions, setQuestions] = useState([]);\r\n    const [comments, setComments] = useState([]);\r\n    const [entry, setEntry] = useState(\"\");\r\n    const [keyword, setKeyword] = useState(\"\");\r\n\r\n    const handleQuestions = () => {\r\n        setQnsCom('forum-myQuestions');\r\n    }\r\n\r\n    const handleComments = () => {\r\n        setQnsCom('forum-myComments');\r\n    }\r\n\r\n    const handleQuestion = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const time = new Date();\r\n            let name: string;\r\n\r\n            await db.collection('Students').doc(userID).get().then(doc => {\r\n                if (doc.exists)\r\n                    name = doc.data()?.firstName + \" \" + doc.data()?.lastName;\r\n            });\r\n\r\n            const docRef = db.collection('Forum').doc(userID).collection('Questions').doc((time.getTime()).toString());\r\n            await docRef.set({\r\n                id: +docRef.id,\r\n                entry: entry,\r\n                posterName: name!,\r\n                posterId: userID,\r\n                dateTime: time.toLocaleString().replace(/\\//g, \"-\"),\r\n                noOfComments: 0,\r\n                deleted: false,\r\n                reported: false\r\n            });\r\n        } catch (e) {\r\n            return console.log(e);\r\n        } finally {\r\n            setLoading(false);\r\n            setShowPostModal(false);\r\n            setEntry(\"\");\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        const questions: any = [];\r\n        const comments: any = [];\r\n\r\n        const questionsListener = db.collection('Forum').doc(userID).collection('Questions').where(\"deleted\", \"==\", false).onSnapshot(snaps => {\r\n            snaps.forEach(snap => questions.push(snap.data()));\r\n        });\r\n\r\n        const commentsListener = db.collection('Forum').doc(userID).collection('Comments').where(\"deleted\", \"==\", false).onSnapshot(snaps => {\r\n            setComments(comments);\r\n            \r\n            snaps.forEach(async (snap) => {\r\n                let post: any = { ...snap.data() }\r\n\r\n                await db.collection('Forum').get().then(users => {\r\n                    users.forEach(user => {\r\n                        return db.collection('Forum').doc(user.id).collection('Questions').doc(snap.data().questionId.toString()).onSnapshot(question => {\r\n                            if(question.exists) {\r\n                                post.question = question.data()?.entry;\r\n                                post.questionRemoved = question.data()?.deleted;\r\n                            }\r\n                        });\r\n                    });\r\n                });\r\n                comments.push(post)\r\n            });\r\n        });\r\n\r\n        setTimeout(() => {\r\n            setQuestions(questions);\r\n            setComments(comments);\r\n\r\n            questionsListener();\r\n            commentsListener();\r\n            setLoading(false);\r\n        }, 500);\r\n    }, []);\r\n   \r\n    return (\r\n        <IonPage>\r\n            <IonHeader>\r\n                <TopNav title=\"Forum\" route=\"/u/forum\" backarrow={ true } hamburger={ true } />\r\n            </IonHeader>\r\n\r\n            <IonContent fullscreen id=\"forum-content\">\r\n                <IonGrid id=\"forum-searchbar-container\">\r\n                    <IonRow className=\"ion-justify-content-start\">\r\n                        <IonCol size=\"10\" className=\"forum-col\">\r\n                            <form onSubmit={e => { e.preventDefault(); history.push(`/u/forumSearch/${keyword}`); }}>\r\n                                <IonSearchbar value={keyword} onIonChange={e => setKeyword(e.detail.value!)} enterkeyhint=\"search\" id=\"forum-searchbar\" animated></IonSearchbar>\r\n                            </form>\r\n                        </IonCol>\r\n                        <IonCol size=\"2\" className=\"forum-col ion-align-self-center\">\r\n                            <ForumRules />\r\n                        </IonCol>\r\n                    </IonRow>\r\n                </IonGrid>\r\n                \r\n                <IonGrid id=\"forumUser-ionRowCol\">\r\n                    <IonRow id=\"forumUser-ionRowCol\">\r\n                        <IonCol id=\"forumUser-ionRowCol\">\r\n                            <IonToolbar>\r\n                                <IonSegment scrollable value={qnsCom} onIonChange={(e) => console.log(`${e.detail.value}`)}>\r\n                                    <IonSegmentButton value=\"forum-myQuestions\" onClick={() => handleQuestions()} className=\"forumUser-heading\">My Questions</IonSegmentButton>\r\n                                    <IonSegmentButton value=\"forum-myComments\" onClick={() => handleComments()} className=\"forumUser-heading\">My Comments</IonSegmentButton>\r\n                                </IonSegment>\r\n                            </IonToolbar>\r\n                        </IonCol>\r\n                    </IonRow>\r\n                </IonGrid>\r\n                {qnsCom === 'forum-myQuestions' ? \r\n                    <ForumQuestions questions={questions} /> : <ForumComments comments={comments} />\r\n                }\r\n                \r\n                {/* Post Question Modal */}\r\n                <IonModal isOpen={showPostModal} cssClass='post-question-modal' onDidDismiss={() => setShowPostModal(false)}>\r\n                    <IonContent>\r\n                        <IonGrid id=\"postQns-modal-container\">\r\n                            <IonRow style={{paddingTop: '1%'}}>\r\n                                <IonLabel id=\"postQns-title\">Post Question</IonLabel>\r\n                            </IonRow>\r\n                            <IonItemDivider />\r\n                            <IonRow id=\"postQns-modal-inputArea\">\r\n                                <IonTextarea value={entry} onIonChange={(e: any) => setEntry(e.detail.value)} rows={11} placeholder=\"Type your question here...\" required></IonTextarea>\r\n                            </IonRow>\r\n                            <IonRow className=\"ion-justify-content-around\">\r\n                                <IonButton id=\"postQns-close-button\" fill=\"outline\" onClick={() => [setShowPostModal(false), setModalSegmentValue('')]}>CLOSE</IonButton>\r\n                                <IonButton id=\"postQns-post-button\" onClick={handleQuestion}>POST</IonButton>\r\n                            </IonRow>\r\n                        </IonGrid>\r\n                    </IonContent>\r\n                </IonModal>\r\n                <IonLoading isOpen={loading} />\r\n            </IonContent>\r\n\r\n            <IonFooter>\r\n                <IonToolbar>\r\n                    <IonSegment scrollable value={modalSegmentValue} onIonChange={(e) => console.log(`${e.detail.value}`)}>\r\n                        <IonSegmentButton className=\"forum-segmentBtn\" value=\"postQuestionBtn\" onClick={() => [setShowPostModal(true), setModalSegmentValue('postQuestionBtn')]}><IonIcon icon={addCircleSharp} /></IonSegmentButton>\r\n                        <IonSegmentButton className=\"forum-segmentBtn\" value=\"forumUserBtn\" onClick={(e) => {e.preventDefault(); history.push('/u/forumUser');}}><IonIcon icon={personSharp} /></IonSegmentButton>\r\n                    </IonSegment>\r\n                </IonToolbar>\r\n            </IonFooter>\r\n        </IonPage>\r\n    );\r\n};\r\n\r\nexport default ForumUser;"]},"metadata":{},"sourceType":"module"}